(()=>{var e={};e.id=750,e.ids=[750],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3787:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>c,routeModule:()=>u,tree:()=>d}),s(8501),s(2029),s(5866);var r=s(3191),a=s(8716),l=s(7922),i=s.n(l),n=s(5231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);s.d(t,o);let d=["",{children:["messages",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8501)),"C:\\Next.js\\JUNK\\front2\\src\\app\\messages\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2029)),"C:\\Next.js\\JUNK\\front2\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Next.js\\JUNK\\front2\\src\\app\\messages\\page.tsx"],x="/messages/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/messages/page",pathname:"/messages",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},602:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},8715:()=>{},8606:(e,t,s)=>{Promise.resolve().then(s.bind(s,5629))},5047:(e,t,s)=>{"use strict";var r=s(7389);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},5629:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>E});var r=s(326),a=s(5047),l=s(7577),i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),o=(e,t)=>{let s=(0,l.forwardRef)(({color:s="currentColor",size:r=24,strokeWidth:a=2,absoluteStrokeWidth:o,className:d="",children:c,...x},m)=>(0,l.createElement)("svg",{ref:m,...i,width:r,height:r,stroke:s,strokeWidth:o?24*Number(a)/Number(r):a,className:["lucide",`lucide-${n(e)}`,d].join(" "),...x},[...t.map(([e,t])=>(0,l.createElement)(e,t)),...Array.isArray(c)?c:[c]]));return s.displayName=`${e}`,s},d=o("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),c=o("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),x=o("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),m=o("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),u=o("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),p=o("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),h=o("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);function g({sessions:e,currentSessionId:t,onSelectSession:s,onNewChat:l,selectedFlow:i,onSelectFlow:n,onToggleOrganizer:o}){let g=(0,a.useRouter)(),y=[{key:"analysis",label:"現状分析・課題整理",icon:r.jsx(d,{size:16})},{key:"objective",label:"目的整理",icon:r.jsx(c,{size:16})},{key:"concept",label:"コンセプト策定",icon:r.jsx(x,{size:16})},{key:"plan",label:"施策立案",icon:r.jsx(m,{size:16})},{key:"proposal",label:"資料作成",icon:r.jsx(u,{size:16})}];return(0,r.jsxs)("aside",{className:"w-64 h-full bg-white border-r border-gray-200 flex flex-col",children:[(0,r.jsxs)("div",{className:"px-4 py-4 border-b border-gray-100 flex items-center gap-3",children:[r.jsx("img",{src:"/avatar.png",className:"w-10 h-10 rounded-full object-cover",alt:"user"}),(0,r.jsxs)("div",{className:"min-w-0",children:[r.jsx("div",{className:"text-sm font-semibold text-gray-800 truncate",children:"鈴木 理沙"}),r.jsx("div",{className:"text-xs text-gray-500 truncate",children:"自治体担当・政策推進"})]})]}),r.jsx("div",{className:"px-4 pt-4",children:(0,r.jsxs)("button",{onClick:()=>{l?.(),g.push("/project")},className:"w-full inline-flex items-center gap-2 rounded-lg px-3 py-2 bg-slate-700 text-white hover:opacity-90 transition",children:[r.jsx(p,{size:16}),"ホーム"]})}),(0,r.jsxs)("div",{className:"px-4 py-4",children:[r.jsx("div",{className:"text-xs font-medium text-gray-500 mb-2",children:"政策立案フロー"}),r.jsx("nav",{className:"space-y-2",children:y.map(e=>{let t=e.key===i;return(0,r.jsxs)("button",{onClick:()=>n(e.key),className:"w-full inline-flex items-center gap-2 px-3 py-2 rounded-md border transition "+(t?"bg-slate-700 text-white border-slate-700 shadow":"bg-slate-100 text-slate-700 border-slate-200 hover:bg-slate-200"),children:[e.icon,r.jsx("span",{className:"text-sm",children:e.label})]},e.key)})})]}),r.jsx("div",{className:"px-4 pb-2",children:r.jsx("button",{onClick:o,className:"w-full py-2 rounded-lg bg-sky-100 text-sky-700 border border-sky-200 hover:bg-sky-50 transition",children:"内容を整理する"})}),r.jsx("div",{className:"px-4 mt-auto pb-4",children:(0,r.jsxs)("details",{className:"group",children:[(0,r.jsxs)("summary",{className:"flex cursor-pointer items-center justify-between text-xs text-gray-500 py-2",children:[r.jsx("span",{children:"チャット履歴"}),r.jsx(h,{size:16,className:"transition-transform group-open:rotate-180 text-gray-400"})]}),r.jsx("div",{className:"mt-2 space-y-1 max-h-48 overflow-auto pr-1",children:e?.length?e.map(e=>r.jsx("button",{onClick:()=>s(e.id),className:`w-full text-left text-sm px-3 py-2 rounded-md border ${t===e.id?"bg-slate-50 border-slate-200 text-slate-900":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"}`,children:e.title||"無題のチャット"},e.id)):r.jsx("div",{className:"text-xs text-gray-400 px-1 py-2",children:"履歴はまだありません"})})]})})]})}let y=o("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),b=o("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]),f=({message:e})=>{let t="user"===e.role;return(0,r.jsxs)("div",{className:`flex gap-4 p-4 ${t?"flex-row-reverse":"flex-row"} animate-fade-in`,children:[r.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${t?"bg-gradient-to-br from-blue-500 to-blue-600 text-white":"bg-gradient-to-br from-purple-500 to-indigo-600 text-white"}`,children:t?r.jsx(y,{size:16}):r.jsx(b,{size:16})}),(0,r.jsxs)("div",{className:`flex-1 max-w-3xl ${t?"text-right":"text-left"}`,children:[(0,r.jsxs)("div",{className:`inline-block p-4 rounded-2xl shadow-sm ${t?"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-br-md":"bg-white border border-gray-200 text-gray-800 rounded-bl-md"}`,children:[r.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.content}),e.searchType&&"normal"!==e.searchType&&r.jsx("div",{className:"mt-2 text-xs opacity-75",children:"fact"===e.searchType?"\uD83D\uDCCA ファクト検索":"\uD83D\uDC65 人脈検索"})]}),r.jsx("div",{className:"mt-1 text-xs text-gray-500",children:e.timestamp.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})})]})]})},j=o("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),v=o("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),w=o("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),N=({onSendMessage:e,isLoading:t})=>{let[s,a]=(0,l.useState)(""),i=r=>{s.trim()&&!t&&(e(s.trim(),r),a(""))};return r.jsx("div",{className:"border-t border-gray-200 bg-white p-4",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex gap-3 items-end",children:[(0,r.jsxs)("div",{className:"flex-1 relative",children:[r.jsx("textarea",{value:s,onChange:e=>a(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),i())},placeholder:"メッセージを入力してください...",className:"w-full p-4 pr-16 border border-gray-300 rounded-2xl resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-200 shadow-sm",rows:s.split("\n").length>3?4:Math.max(1,s.split("\n").length),disabled:t}),r.jsx("div",{className:"absolute right-2 bottom-2 text-xs text-gray-400",children:"Enter送信"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>i(),disabled:!s.trim()||t,className:"p-3 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 group",title:"送信",children:r.jsx(j,{size:18,className:"group-hover:translate-x-0.5 transition-transform duration-200"})}),r.jsx("button",{onClick:()=>i("fact"),disabled:!s.trim()||t,className:"p-3 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 group",title:"ファクト検索",children:r.jsx(v,{size:18,className:"group-hover:rotate-12 transition-transform duration-200"})}),r.jsx("button",{onClick:()=>i("network"),disabled:!s.trim()||t,className:"p-3 bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl hover:from-purple-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 group",title:"人脈検索",children:r.jsx(w,{size:18,className:"group-hover:scale-110 transition-transform duration-200"})})]})]}),(0,r.jsxs)("div",{className:"mt-3 flex gap-4 text-xs text-gray-500",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-3 h-3 bg-gradient-to-br from-blue-500 to-blue-600 rounded"}),r.jsx("span",{children:"通常送信"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-3 h-3 bg-gradient-to-br from-green-500 to-green-600 rounded"}),r.jsx("span",{children:"ファクト検索"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-3 h-3 bg-gradient-to-br from-purple-500 to-purple-600 rounded"}),r.jsx("span",{children:"人脈検索"})]})]})]})})},k=function({onSendMessage:e,isLoading:t}){let[s,a]=(0,l.useState)(""),i=(r,l)=>{let i=(r??s).trim();i&&!t&&(e(i,l),a(""))},n=e=>{"test"===e?i(s):"fact"===e?i(s,"fact"):"network"===e&&i(s,"network")};return r.jsx("div",{className:"flex-1 overflow-auto",children:(0,r.jsxs)("div",{className:"h-full max-w-4xl mx-auto px-4 py-16 flex flex-col items-center justify-center",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-8",children:[r.jsx("img",{src:"/logo.png",alt:"METIST",className:"h-8"}),r.jsx("span",{className:"text-2xl font-semibold tracking-wide text-sky-700",children:"METIST"})]}),r.jsx("h1",{className:"text-xl font-semibold text-gray-800 mb-6 text-center",children:"今日はどんなことにお困りですか？"}),(0,r.jsxs)("div",{className:"w-full max-w-3xl",children:[(0,r.jsxs)("div",{className:"flex items-center bg-white rounded-full border border-gray-200 px-4 py-3 shadow-sm",children:[r.jsx("span",{className:"mr-2 text-gray-400",children:"\uD83D\uDD0D"}),r.jsx("input",{type:"text",className:"flex-1 outline-none text-gray-800 placeholder:text-gray-400",placeholder:"質問してみましょう",value:s,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"===e.key&&i()},disabled:t}),r.jsx("span",{className:"text-gray-400 text-xs ml-2",children:"Enter 送信"})]}),(0,r.jsxs)("div",{className:"flex gap-3 justify-center mt-6",children:[r.jsx("button",{onClick:()=>n("test"),disabled:t||!s.trim(),className:"px-4 py-2 rounded-full bg-indigo-100 text-indigo-700 border border-indigo-200 hover:bg-indigo-50 disabled:opacity-50",title:"試験モードで送信",children:"▶ 送信"}),r.jsx("button",{onClick:()=>n("fact"),disabled:t||!s.trim(),className:"px-4 py-2 rounded-full bg-green-100 text-green-700 border border-green-200 hover:bg-green-50 disabled:opacity-50",title:"ファクト検索モードで送信",children:"\uD83D\uDD0E ファクト検索"}),r.jsx("button",{onClick:()=>n("network"),disabled:t||!s.trim(),className:"px-4 py-2 rounded-full bg-purple-100 text-purple-700 border border-purple-200 hover:bg-purple-50 disabled:opacity-50",title:"人脈検索モードで送信",children:"\uD83D\uDC65 人脈検索"})]})]})]})})},S={analysis:{title:"現状分析・課題整理：まず「現状」「根本原因」「優先度」を言語化しましょう。",prompts:["課題と裏付け（定量・定性）を記入してください","課題の背景にある構造（制度・市場など）を簡単に評価してください","解決すべき課題の優先度と理由を整理しましょう"]},objective:{title:"目的整理：達成したい状態と評価指標（KPI）を定めます。",prompts:["最終的に達成したいゴールを具体的に記載してください","KPI・目標値（いつまでに・どれだけ）を記入してください","前提条件・制約（予算、人員、期間など）を整理しましょう"]},concept:{title:"コンセプト策定：基本方針と解決アプローチを1枚で説明できるようにします。",prompts:["基本方針（どんな価値を誰に、どう届けるか）を記入してください","方針の根拠・示唆（調査、事例、専門家意見など）を書いてください","主要リスクと打ち手（代替案、実験設計）を整理しましょう"]},plan:{title:"施策案作成：実行体制・ロードマップ・概算コストまで見通します。",prompts:["主な施策（3〜5個）の概要と狙いを整理してください","体制・役割分担・スケジュールを記入してください","概算コスト・効果見込み（根拠も）を書いてください"]},proposal:{title:"提案書作成：意思決定者に伝わるストーリーでまとめます。",prompts:["提案のサマリー（背景→課題→解決→効果→体制）を書いてください","意思決定者の関心（費用対効果、リスク、責任分担）を整理してください","次のアクション（承認プロセス、関係者説明、PoC準備など）を記入してください"]}};function D({projectId:e,flow:t,onSaved:s}){let a=`organizer:${e??"no-project"}:${t}`,[i,n]=(0,l.useState)(["","",""]),[o,d]=(0,l.useState)(!1),c=S[t];return(0,r.jsxs)("div",{className:"w-[360px] min-w-[360px] h-full bg-white border-l border-gray-200 flex flex-col",children:[(0,r.jsxs)("div",{className:"px-4 py-3 border-b bg-gray-50",children:[r.jsx("div",{className:"text-xs text-gray-500",children:"内容整理"}),r.jsx("div",{className:"mt-1 text-[13px] leading-snug text-gray-800",children:c.title})]}),r.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:c.prompts.map((e,t)=>(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("div",{className:"text-xs text-gray-500",children:e}),r.jsx("textarea",{className:"w-full h-28 resize-none rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-sky-300 px-2 py-1 text-sm",value:i[t],onChange:e=>{let s=[...i];s[t]=e.target.value,n(s)},placeholder:"ここに入力してください"})]},t))}),r.jsx("div",{className:"p-3 border-t",children:r.jsx("button",{onClick:()=>{localStorage.setItem(a,JSON.stringify(i)),d(!0),s?.(),setTimeout(()=>d(!1),1400)},className:"w-full rounded-md bg-slate-700 text-white py-2 text-sm hover:bg-slate-800",children:"保存"})}),o&&r.jsx("div",{className:"absolute right-[380px] top-6 rounded-md bg-gray-100 shadow px-4 py-2 text-sm",children:"保存しました"})]})}class M extends Error{constructor(e,t){super(t),this.status=e,this.name="ApiError"}}async function C(e,t){let s=`http://127.0.0.1:8000${e}`;try{let e=await fetch(s,{headers:{"Content-Type":"application/json",...t?.headers},...t});if(!e.ok)throw new M(e.status,`HTTP error! status: ${e.status}`);return await e.json()}catch(e){if(e instanceof M)throw e;throw Error(`Network error: ${e instanceof Error?e.message:"Unknown error"}`)}}let P={sendMessage:async e=>C("/api/chat",{method:"POST",body:JSON.stringify(e)}),sendFlexiblePolicyMessage:async e=>C("/api/policy-flexible",{method:"POST",body:JSON.stringify(e)})},_="chat_sessions",z=()=>{let[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)(null),[a,i]=(0,l.useState)(!1),[n,o]=(0,l.useState)(null),[d,c]=(0,l.useState)(null),x=e.find(e=>e.id===s),m=x?.messages||[];(0,l.useEffect)(()=>{try{let e=localStorage.getItem(_);if(e){let s=JSON.parse(e).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),messages:e.messages.map(e=>({...e,timestamp:new Date(e.timestamp)}))}));t(s)}}catch(e){console.error("Failed to load sessions from localStorage:",e)}},[]);let u=(0,l.useCallback)(e=>{try{localStorage.setItem(_,JSON.stringify(e))}catch(e){console.error("Failed to save sessions to localStorage:",e)}},[]),p=(0,l.useCallback)(e=>{let s=Date.now().toString(),a={id:s,title:e.length>30?e.substring(0,30)+"...":e,messages:[],createdAt:new Date,updatedAt:new Date};return t(e=>{let t=[a,...e];return u(t),t}),r(s),s},[u]),h=(0,l.useCallback)(e=>{r(e),o(null)},[]),g=(0,l.useCallback)(()=>{r(null),o(null)},[]),y=e=>({id:e.id,content:e.content,role:"ai"===e.type?"assistant":"user",timestamp:new Date(e.timestamp),searchType:"fact"===e.search_type||"network"===e.search_type?e.search_type:void 0}),b=(0,l.useCallback)(async(e,r,a,l)=>{let n=s;n||(n=p(e));let d={id:Date.now().toString(),content:e,role:"user",timestamp:new Date,searchType:"fact"===r||"network"===r?r:void 0};t(e=>{let t=e.map(e=>e.id===n?{...e,messages:[...e.messages,d],updatedAt:new Date}:e);return u(t),t}),i(!0),o(null);try{let s,i;let o={content:e,search_type:r??"normal",flow_step:a,session_id:n,project_id:l};if("fact"===r||"network"===r)s=await P.sendMessage(o),i=y(s);else if(a){let e=await P.sendFlexiblePolicyMessage(o);e.full_state&&c({session_id:e.session_id,project_id:e.project_id,...e.full_state}),i={id:e.id,content:e.content,role:"assistant",timestamp:new Date(e.timestamp),searchType:void 0}}else s=await P.sendMessage(o),i=y(s);t(e=>{let t=e.map(e=>e.id===n?{...e,messages:[...e.messages,i],updatedAt:new Date}:e);return u(t),t})}catch(r){console.error("Failed to send message:",r);let e="メッセージの送信に失敗しました。";r instanceof M?500===r.status?e="サーバーエラーが発生しました。しばらく待ってから再試行してください。":(0===r.status||r.message.includes("Network error"))&&(e="バックエンドサーバーに接続できません。サーバーが起動しているか確認してください。"):r instanceof Error&&r.message.includes("Network error")&&(e="ネットワークエラーが発生しました。接続を確認してください。"),o(e);let s={id:(Date.now()+1).toString(),content:`❌ ${e}`,role:"assistant",timestamp:new Date};t(e=>{let t=e.map(e=>e.id===n?{...e,messages:[...e.messages,s],updatedAt:new Date}:e);return u(t),t})}finally{i(!1)}},[s,p,u]);return{sessions:e,currentSessionId:s,messages:m,sendMessage:b,selectSession:h,startNewChat:g,isLoading:a,error:n,sessionState:d}};function A({projectId:e,initialFlow:t="analysis"}){let{sessions:s,currentSessionId:a,messages:i,sendMessage:n,selectSession:o,startNewChat:d,isLoading:c}=z(),[x,m]=(0,l.useState)(t),[u,p]=(0,l.useState)(!1),h=(0,l.useRef)(null),y=!a||0===i.length;return(0,r.jsxs)("div",{className:"flex h-screen overflow-hidden bg-gray-100",children:[r.jsx(g,{sessions:s,currentSessionId:a,onSelectSession:e=>o(e),onNewChat:()=>d(),selectedFlow:x,onSelectFlow:e=>m(e),onToggleOrganizer:()=>p(e=>!e)}),r.jsx("div",{className:"flex-1 flex flex-col min-w-0",children:y?r.jsx(k,{onSendMessage:(t,s)=>n(t,s,x,e),isLoading:c}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"flex-1 overflow-y-auto px-4 bg-gradient-to-br from-gray-50 via-white to-blue-50",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto py-6 space-y-1",children:[i.map(e=>r.jsx(f,{message:e},e.id)),c&&(0,r.jsxs)("div",{className:"flex gap-4 p-4 animate-pulse",children:[r.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center",children:r.jsx("div",{className:"w-4 h-4 bg-white rounded-full animate-ping"})}),r.jsx("div",{className:"flex-1 max-w-3xl",children:r.jsx("div",{className:"inline-block p-4 rounded-2xl bg-white border border-gray-200 rounded-bl-md",children:(0,r.jsxs)("div",{className:"flex space-x-1",children:[r.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),r.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),r.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})})]}),r.jsx("div",{ref:h})]})}),r.jsx(N,{isLoading:c,onSendMessage:async(t,s)=>{if(e)try{localStorage.setItem(`messages:${e}:${x}`,"1")}catch{}await n(t,s,x,e)}})]})}),u&&r.jsx(D,{projectId:e,flow:x,onSaved:()=>{if(e)try{localStorage.setItem(`organizer:${e}:${x}`,"1")}catch{}}})]})}function T(){let e=(0,a.useSearchParams)(),t=e.get("projectId")||void 0,s=e.get("flow")||"analysis";return r.jsx(A,{projectId:t,initialFlow:s})}function E(){return r.jsx(l.Suspense,{fallback:r.jsx("div",{children:"Loading..."}),children:r.jsx(T,{})})}},2029:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l,metadata:()=>a});var r=s(9510);s(5023);let a={title:"AIエージェント - インテリジェント検索対応チャット",description:"AIエージェントとのチャット機能を提供するアプリケーション"};function l({children:e}){return r.jsx("html",{lang:"ja",children:r.jsx("body",{children:e})})}},8501:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`C:\Next.js\JUNK\front2\src\app\messages\page.tsx#default`)},5023:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[819],()=>s(3787));module.exports=r})();