(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{468:function(){},1510:function(e,t,a){Promise.resolve().then(a.bind(a,8915))},8915:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var s=a(7437),r=a(2265),n=a(9376),o=a(7426);let l=/^[0-9]{5,}$/,c=/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/,i="login_lock_info";function d(){try{return JSON.parse(localStorage.getItem(i)||"{}")}catch(e){return{count:0}}}function u(e){localStorage.setItem(i,JSON.stringify(e))}function m(){let e=(0,n.useRouter)(),[t,a]=(0,r.useState)(""),[m,x]=(0,r.useState)(""),[f,b]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!1),[g,y]=(0,r.useState)(null),N=(0,r.useMemo)(d,[]),j=Date.now(),w=(N.lockedUntil&&N.lockedUntil>j?N.lockedUntil-j:0)>0,k=t&&!l.test(t)?"職員番号は5桁以上の数字で入力してください":"",v=m&&!c.test(m)?"半角英数8文字以上（英字・数字を各1文字以上）":"",S=!w&&l.test(t)&&c.test(m)&&!h;async function C(a){if(a.preventDefault(),S){p(!0),y(null);try{let a=await o.ZP.hash(m,10);if(!(l.test(t)&&c.test(m)))throw Error("認証に失敗しました");let s=btoa(JSON.stringify({sub:t,iat:Date.now(),rnd:crypto.getRandomValues(new Uint32Array(1))[0]}));sessionStorage.setItem("auth",JSON.stringify({token:s,clientHashedPassword:a,expiresAt:Date.now()+36e5})),localStorage.removeItem(i),e.push("/project_start")}catch(t){let e=(d().count||0)+1;e>=5?(u({count:0,lockedUntil:Date.now()+3e5}),y("試行回数が上限に達しました。".concat(Math.ceil(5),"分後に再試行してください。"))):(u({count:e,lockedUntil:0}),y("ログインに失敗しました（残り ".concat(5-e," 回でロック）")))}finally{p(!1)}}}return(0,s.jsxs)("form",{onSubmit:C,autoComplete:"off",className:"bg-white rounded-xl border border-gray-200 p-8 shadow-sm",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"職員番号"}),(0,s.jsx)("input",{inputMode:"numeric",autoCapitalize:"off",autoCorrect:"off",name:"empId",placeholder:"12345",value:t,onChange:e=>a(e.target.value.trim()),disabled:h||w,className:"w-full rounded-lg border px-3 py-2 mb-2 outline-none ".concat(k?"border-red-300 focus:border-red-400":"border-gray-300 focus:border-gray-400")}),k&&(0,s.jsx)("p",{className:"text-xs text-red-500 mb-3",children:k}),(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:f?"text":"password",autoCapitalize:"off",autoCorrect:"off",name:"password",placeholder:"パスワード",value:m,onChange:e=>x(e.target.value),disabled:h||w,className:"w-full rounded-lg border px-3 py-2 pr-10 outline-none ".concat(v?"border-red-300 focus:border-red-400":"border-gray-300 focus:border-gray-400")}),(0,s.jsx)("button",{type:"button",tabIndex:-1,onClick:()=>b(e=>!e),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":f?"パスワードを隠す":"パスワードを表示"})]}),v&&(0,s.jsx)("p",{className:"text-xs text-red-500 mt-2",children:v}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)("a",{className:"text-xs text-gray-500 underline hover:text-gray-700",href:"/forgot",children:"パスワードを忘れた方はこちら"})}),g&&(0,s.jsx)("p",{className:"mt-4 text-sm text-red-600",children:g}),w&&(0,s.jsx)("p",{className:"mt-2 text-xs text-orange-600",children:"ログインが一時的に制限されています（しばらくお待ちください）"}),(0,s.jsx)("div",{className:"mt-8 flex justify-center",children:(0,s.jsx)("button",{type:"submit",disabled:!S,className:"px-10 py-2 rounded-full bg-slate-800 text-white disabled:opacity-50",children:h?"Processing…":"Login"})})]})}function x(){return(0,s.jsx)("main",{className:"min-h-screen bg-gray-100",children:(0,s.jsxs)("div",{className:"max-w-xl mx-auto px-4 py-16",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-8",children:[(0,s.jsx)("img",{src:"/logo.png",alt:"METIST",className:"h-8"}),(0,s.jsx)("span",{className:"text-2xl font-semibold tracking-wide text-sky-700",children:"METIST"})]}),(0,s.jsx)(m,{})]})})}}},function(e){e.O(0,[893,971,117,744],function(){return e(e.s=1510)}),_N_E=e.O()}]);