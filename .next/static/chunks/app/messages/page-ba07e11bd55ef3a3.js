(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[750],{3130:function(e,t,s){Promise.resolve().then(s.bind(s,9737))},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},9737:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return L}});var a=s(7437),r=s(9376),l=s(2265),n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,t)=>{let s=(0,l.forwardRef)((s,a)=>{let{color:r="currentColor",size:i=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:h="",children:u,...x}=s;return(0,l.createElement)("svg",{ref:a,...n,width:i,height:i,stroke:r,strokeWidth:d?24*Number(c)/Number(i):c,className:["lucide","lucide-".concat(o(e)),h].join(" "),...x},[...t.map(e=>{let[t,s]=e;return(0,l.createElement)(t,s)}),...Array.isArray(u)?u:[u]])});return s.displayName="".concat(e),s},c=i("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),d=i("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),h=i("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),u=i("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),x=i("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),m=i("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),p=i("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),g=(()=>{console.log("Client-side env check:","https://aps-junk-02-h7hxetfcdkfpeydk.canadacentral-01.azurewebsites.net");let e="https://aps-junk-02-h7hxetfcdkfpeydk.canadacentral-01.azurewebsites.net",t="http://127.0.0.1:8000";return console.log("Environment variable NEXT_PUBLIC_API_ENDPOINT:",e),console.log("Using API endpoint:",e||t),e||t})();class y extends Error{constructor(e,t){super(t),this.status=e,this.name="ApiError"}}async function f(e,t){let s="".concat(g).concat(e);console.log("API Request: ".concat((null==t?void 0:t.method)||"GET"," ").concat(s));try{let e=await fetch(s,{headers:{"Content-Type":"application/json",...null==t?void 0:t.headers},mode:"cors",credentials:"omit",...t});if(console.log("API Response: ".concat(e.status," ").concat(e.statusText)),!e.ok){let t=await e.text().catch(()=>"Unable to read error response");throw console.error("API Error Response: ".concat(t)),new y(e.status,"HTTP error! status: ".concat(e.status,", message: ").concat(t))}let a=await e.json();return console.log("API Success:",a),a}catch(e){if(console.error("API Fetch Error:",e),e instanceof y)throw e;if(e instanceof TypeError&&e.message.includes("fetch"))throw Error("Network error: Unable to connect to server. Please check your internet connection and try again.");throw Error("Network error: ".concat(e instanceof Error?e.message:"Unknown error"))}}let b={sendMessage:async e=>f("/api/chat",{method:"POST",body:JSON.stringify(e)}),getSessions:async()=>f("/api/sessions"),createSession:async()=>f("/api/sessions",{method:"POST"}),sendFlexiblePolicyMessage:async e=>f("/api/policy-flexible",{method:"POST",body:JSON.stringify(e)}),getSessionState:async e=>f("/api/session-state/".concat(e)),async healthCheck(){try{return await f("/")}catch(e){throw console.error("Health check failed:",e),e}},async testConnection(){try{return await this.healthCheck(),!0}catch(e){return console.error("Connection test failed:",e),!1}}},j=i("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),v=i("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),w=i("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),k=()=>{let[e,t]=(0,l.useState)(null),[s,r]=(0,l.useState)(!1),[n,o]=(0,l.useState)(null),i=async()=>{r(!0),o(null);try{console.log("Starting connection test...");let e=await b.testConnection();console.log("Connection test result:",e),t(e),e||o("Connection test failed")}catch(e){console.error("Connection test error:",e),t(!1),o(e instanceof Error?e.message:"Unknown error")}finally{r(!1)}};return(0,a.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg border",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"API接続テスト"}),(0,a.jsxs)("button",{onClick:i,disabled:s,className:"flex items-center gap-1 px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:[s?(0,a.jsx)(j,{className:"w-3 h-3 animate-spin"}):(0,a.jsx)(j,{className:"w-3 h-3"}),"テスト"]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2 text-xs",children:null===e?(0,a.jsx)("span",{className:"text-gray-500",children:"未テスト"}):e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v,{className:"w-3 h-3 text-green-500"}),(0,a.jsx)("span",{className:"text-green-600",children:"接続OK"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w,{className:"w-3 h-3 text-red-500"}),(0,a.jsx)("span",{className:"text-red-600",children:"接続エラー"})]})}),n&&(0,a.jsx)("div",{className:"mt-1 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-600",children:n}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:["Endpoint: ","https://aps-junk-02-h7hxetfcdkfpeydk.canadacentral-01.azurewebsites.net"]})]})};function N(e){let{sessions:t,currentSessionId:s,onSelectSession:l,onNewChat:n,selectedFlow:o,onSelectFlow:i,onToggleOrganizer:g}=e,y=(0,r.useRouter)(),f=[{key:"analysis",label:"現状分析・課題整理",icon:(0,a.jsx)(c,{size:16})},{key:"objective",label:"目的整理",icon:(0,a.jsx)(d,{size:16})},{key:"concept",label:"コンセプト策定",icon:(0,a.jsx)(h,{size:16})},{key:"plan",label:"施策立案",icon:(0,a.jsx)(u,{size:16})},{key:"proposal",label:"資料作成",icon:(0,a.jsx)(x,{size:16})}];return(0,a.jsxs)("aside",{className:"w-64 h-full bg-white border-r border-gray-200 flex flex-col",children:[(0,a.jsxs)("div",{className:"px-4 py-4 border-b border-gray-100 flex items-center gap-3",children:[(0,a.jsx)("img",{src:"/avatar.png",className:"w-10 h-10 rounded-full object-cover",alt:"user"}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-gray-800 truncate",children:"鈴木 理沙"}),(0,a.jsx)("div",{className:"text-xs text-gray-500 truncate",children:"自治体担当・政策推進"})]})]}),(0,a.jsx)("div",{className:"px-4 pt-4",children:(0,a.jsxs)("button",{onClick:()=>{null==n||n(),y.push("/project")},className:"w-full inline-flex items-center gap-2 rounded-lg px-3 py-2 bg-slate-700 text-white hover:opacity-90 transition",children:[(0,a.jsx)(m,{size:16}),"ホーム"]})}),(0,a.jsxs)("div",{className:"px-4 py-4",children:[(0,a.jsx)("div",{className:"text-xs font-medium text-gray-500 mb-2",children:"政策立案フロー"}),(0,a.jsx)("nav",{className:"space-y-2",children:f.map(e=>{let t=e.key===o;return(0,a.jsxs)("button",{onClick:()=>i(e.key),className:"w-full inline-flex items-center gap-2 px-3 py-2 rounded-md border transition "+(t?"bg-slate-700 text-white border-slate-700 shadow":"bg-slate-100 text-slate-700 border-slate-200 hover:bg-slate-200"),children:[e.icon,(0,a.jsx)("span",{className:"text-sm",children:e.label})]},e.key)})})]}),(0,a.jsx)("div",{className:"px-4 pb-2",children:(0,a.jsx)("button",{onClick:g,className:"w-full py-2 rounded-lg bg-sky-100 text-sky-700 border border-sky-200 hover:bg-sky-50 transition",children:"内容を整理する"})}),(0,a.jsx)("div",{className:"px-4 mt-auto pb-4",children:(0,a.jsxs)("details",{className:"group",children:[(0,a.jsxs)("summary",{className:"flex cursor-pointer items-center justify-between text-xs text-gray-500 py-2",children:[(0,a.jsx)("span",{children:"チャット履歴"}),(0,a.jsx)(p,{size:16,className:"transition-transform group-open:rotate-180 text-gray-400"})]}),(0,a.jsx)("div",{className:"mt-2 space-y-1 max-h-48 overflow-auto pr-1",children:(null==t?void 0:t.length)?t.map(e=>(0,a.jsx)("button",{onClick:()=>l(e.id),className:"w-full text-left text-sm px-3 py-2 rounded-md border ".concat(s===e.id?"bg-slate-50 border-slate-200 text-slate-900":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"),children:e.title||"無題のチャット"},e.id)):(0,a.jsx)("div",{className:"text-xs text-gray-400 px-1 py-2",children:"履歴はまだありません"})})]})}),(0,a.jsx)("div",{className:"px-4 pb-4",children:(0,a.jsx)(k,{})})]})}let S=i("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),M=i("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]),C=e=>{let{message:t}=e,s="user"===t.role;return(0,a.jsxs)("div",{className:"flex gap-4 p-4 ".concat(s?"flex-row-reverse":"flex-row"," animate-fade-in"),children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ".concat(s?"bg-gradient-to-br from-blue-500 to-blue-600 text-white":"bg-gradient-to-br from-purple-500 to-indigo-600 text-white"),children:s?(0,a.jsx)(S,{size:16}):(0,a.jsx)(M,{size:16})}),(0,a.jsxs)("div",{className:"flex-1 max-w-3xl ".concat(s?"text-right":"text-left"),children:[(0,a.jsxs)("div",{className:"inline-block p-4 rounded-2xl shadow-sm ".concat(s?"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-br-md":"bg-white border border-gray-200 text-gray-800 rounded-bl-md"),children:[(0,a.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:t.content}),t.searchType&&(0,a.jsx)("div",{className:"mt-2 text-xs opacity-75",children:"fact"===t.searchType?"\uD83D\uDCCA ファクト検索":"\uD83D\uDC65 人脈検索"})]}),(0,a.jsx)("div",{className:"mt-1 text-xs text-gray-500",children:t.timestamp.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})})]})]})},D=i("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),E=i("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),z=i("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),P=e=>{let{onSendMessage:t,isLoading:s}=e,[r,n]=(0,l.useState)(""),o=e=>{r.trim()&&!s&&(t(r.trim(),e),n(""))};return(0,a.jsx)("div",{className:"border-t border-gray-200 bg-white p-4",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex gap-3 items-end",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("textarea",{value:r,onChange:e=>n(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),o())},placeholder:"メッセージを入力してください...",className:"w-full p-4 pr-16 border border-gray-300 rounded-2xl resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-200 shadow-sm",rows:r.split("\n").length>3?4:Math.max(1,r.split("\n").length),disabled:s}),(0,a.jsx)("div",{className:"absolute right-2 bottom-2 text-xs text-gray-400",children:"Enter送信"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>o(),disabled:!r.trim()||s,className:"p-3 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 group",title:"送信",children:(0,a.jsx)(D,{size:18,className:"group-hover:translate-x-0.5 transition-transform duration-200"})}),(0,a.jsx)("button",{onClick:()=>o("fact"),disabled:!r.trim()||s,className:"p-3 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 group",title:"ファクト検索",children:(0,a.jsx)(E,{size:18,className:"group-hover:rotate-12 transition-transform duration-200"})}),(0,a.jsx)("button",{onClick:()=>o("network"),disabled:!r.trim()||s,className:"p-3 bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl hover:from-purple-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 group",title:"人脈検索",children:(0,a.jsx)(z,{size:18,className:"group-hover:scale-110 transition-transform duration-200"})})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex gap-4 text-xs text-gray-500",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-gradient-to-br from-blue-500 to-blue-600 rounded"}),(0,a.jsx)("span",{children:"通常送信"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-gradient-to-br from-green-500 to-green-600 rounded"}),(0,a.jsx)("span",{children:"ファクト検索"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-gradient-to-br from-purple-500 to-purple-600 rounded"}),(0,a.jsx)("span",{children:"人脈検索"})]})]})]})})};var I=function(e){let{onSendMessage:t,isLoading:s}=e,[r,n]=(0,l.useState)(""),o=(e,a)=>{let l=(null!=e?e:r).trim();l&&!s&&(t(l,a),n(""))},i=e=>{"test"===e?o(r):"fact"===e?o(r,"fact"):"network"===e&&o(r,"network")};return(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:(0,a.jsxs)("div",{className:"h-full max-w-4xl mx-auto px-4 py-16 flex flex-col items-center justify-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-8",children:[(0,a.jsx)("img",{src:"/logo.png",alt:"METIST",className:"h-8"}),(0,a.jsx)("span",{className:"text-2xl font-semibold tracking-wide text-sky-700",children:"METIST"})]}),(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-800 mb-6 text-center",children:"今日はどんなことにお困りですか？"}),(0,a.jsxs)("div",{className:"w-full max-w-3xl",children:[(0,a.jsxs)("div",{className:"flex items-center bg-white rounded-full border border-gray-200 px-4 py-3 shadow-sm",children:[(0,a.jsx)("span",{className:"mr-2 text-gray-400",children:"\uD83D\uDD0D"}),(0,a.jsx)("input",{type:"text",className:"flex-1 outline-none text-gray-800 placeholder:text-gray-400",placeholder:"質問してみましょう",value:r,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"===e.key&&o()},disabled:s}),(0,a.jsx)("span",{className:"text-gray-400 text-xs ml-2",children:"Enter 送信"})]}),(0,a.jsxs)("div",{className:"flex gap-3 justify-center mt-6",children:[(0,a.jsx)("button",{onClick:()=>i("test"),disabled:s||!r.trim(),className:"px-4 py-2 rounded-full bg-indigo-100 text-indigo-700 border border-indigo-200 hover:bg-indigo-50 disabled:opacity-50",title:"試験モードで送信",children:"▶ 送信"}),(0,a.jsx)("button",{onClick:()=>i("fact"),disabled:s||!r.trim(),className:"px-4 py-2 rounded-full bg-green-100 text-green-700 border border-green-200 hover:bg-green-50 disabled:opacity-50",title:"ファクト検索モードで送信",children:"\uD83D\uDD0E ファクト検索"}),(0,a.jsx)("button",{onClick:()=>i("network"),disabled:s||!r.trim(),className:"px-4 py-2 rounded-full bg-purple-100 text-purple-700 border border-purple-200 hover:bg-purple-50 disabled:opacity-50",title:"人脈検索モードで送信",children:"\uD83D\uDC65 人脈検索"})]})]})]})})};let A={analysis:{title:"現状分析・課題整理：まず「現状」「根本原因」「優先度」を言語化しましょう。",prompts:["課題と裏付け（定量・定性）を記入してください","課題の背景にある構造（制度・市場など）を簡単に評価してください","解決すべき課題の優先度と理由を整理しましょう"]},objective:{title:"目的整理：達成したい状態と評価指標（KPI）を定めます。",prompts:["最終的に達成したいゴールを具体的に記載してください","KPI・目標値（いつまでに・どれだけ）を記入してください","前提条件・制約（予算、人員、期間など）を整理しましょう"]},concept:{title:"コンセプト策定：基本方針と解決アプローチを1枚で説明できるようにします。",prompts:["基本方針（どんな価値を誰に、どう届けるか）を記入してください","方針の根拠・示唆（調査、事例、専門家意見など）を書いてください","主要リスクと打ち手（代替案、実験設計）を整理しましょう"]},plan:{title:"施策案作成：実行体制・ロードマップ・概算コストまで見通します。",prompts:["主な施策（3〜5個）の概要と狙いを整理してください","体制・役割分担・スケジュールを記入してください","概算コスト・効果見込み（根拠も）を書いてください"]},proposal:{title:"提案書作成：意思決定者に伝わるストーリーでまとめます。",prompts:["提案のサマリー（背景→課題→解決→効果→体制）を書いてください","意思決定者の関心（費用対効果、リスク、責任分担）を整理してください","次のアクション（承認プロセス、関係者説明、PoC準備など）を記入してください"]}};function T(e){let{projectId:t,flow:s,onSaved:r}=e,n="organizer:".concat(null!=t?t:"no-project",":").concat(s),[o,i]=(0,l.useState)(["","",""]),[c,d]=(0,l.useState)(!1);(0,l.useEffect)(()=>{try{let a=localStorage.getItem(n);if(a){var e,t,s;let r=JSON.parse(a);Array.isArray(r)&&3===r.length?i([null!==(e=r[0])&&void 0!==e?e:"",null!==(t=r[1])&&void 0!==t?t:"",null!==(s=r[2])&&void 0!==s?s:""]):i(["","",""])}else i(["","",""])}catch(e){i(["","",""])}},[n]);let h=A[s];return(0,a.jsxs)("div",{className:"w-[360px] min-w-[360px] h-full bg-white border-l border-gray-200 flex flex-col",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b bg-gray-50",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"内容整理"}),(0,a.jsx)("div",{className:"mt-1 text-[13px] leading-snug text-gray-800",children:h.title})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:h.prompts.map((e,t)=>(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e}),(0,a.jsx)("textarea",{className:"w-full h-28 resize-none rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-sky-300 px-2 py-1 text-sm",value:o[t],onChange:e=>{let s=[...o];s[t]=e.target.value,i(s)},placeholder:"ここに入力してください"})]},t))}),(0,a.jsx)("div",{className:"p-3 border-t",children:(0,a.jsx)("button",{onClick:()=>{localStorage.setItem(n,JSON.stringify(o)),d(!0),null==r||r(),setTimeout(()=>d(!1),1400)},className:"w-full rounded-md bg-slate-700 text-white py-2 text-sm hover:bg-slate-800",children:"保存"})}),c&&(0,a.jsx)("div",{className:"absolute right-[380px] top-6 rounded-md bg-gray-100 shadow px-4 py-2 text-sm",children:"保存しました"})]})}let _="https://aps-junk-02-h7hxetfcdkfpeydk.canadacentral-01.azurewebsites.net",O="chat_sessions",R=()=>{let[e,t]=(0,l.useState)([]),[s,a]=(0,l.useState)(null),[r,n]=(0,l.useState)(!1),[o,i]=(0,l.useState)(null),[c,d]=(0,l.useState)(null),h=e.find(e=>e.id===s),u=(null==h?void 0:h.messages)||[];(0,l.useEffect)(()=>{try{let e=localStorage.getItem(O);if(e){let s=JSON.parse(e).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),messages:e.messages.map(e=>({...e,timestamp:new Date(e.timestamp)}))}));t(s)}}catch(e){console.error("Failed to load sessions from localStorage:",e)}},[]);let x=(0,l.useCallback)(e=>{try{localStorage.setItem(O,JSON.stringify(e))}catch(e){console.error("Failed to save sessions to localStorage:",e)}},[]),m=(0,l.useCallback)(e=>{let s=Date.now().toString(),r={id:s,title:e.length>30?e.substring(0,30)+"...":e,messages:[],createdAt:new Date,updatedAt:new Date};return t(e=>{let t=[r,...e];return x(t),t}),a(s),s},[x]),p=(0,l.useCallback)(e=>{a(e),i(null)},[]),g=(0,l.useCallback)(()=>{a(null),i(null)},[]),f=e=>({id:e.id,content:e.content,role:"ai"===e.type?"assistant":"user",timestamp:new Date(e.timestamp),searchType:"fact"===e.search_type||"network"===e.search_type?e.search_type:void 0}),j=(0,l.useCallback)(async(e,a,r,l)=>{let o=s;o||(o=m(e));let c={id:Date.now().toString(),content:e,role:"user",timestamp:new Date,searchType:"fact"===a||"network"===a?a:void 0};t(e=>{let t=e.map(e=>e.id===o?{...e,messages:[...e.messages,c],updatedAt:new Date}:e);return x(t),t}),n(!0),i(null);try{let s,n;let i={content:e,search_type:a,flow_step:r,session_id:o,project_id:l};if("fact"===a||"network"===a)s=await b.sendMessage(i),n=f(s);else if(r){let e=await b.sendFlexiblePolicyMessage(i);e.full_state&&d({session_id:e.session_id,project_id:e.project_id,...e.full_state}),n={id:e.id,content:e.content,role:"assistant",timestamp:new Date(e.timestamp),searchType:void 0}}else s=await b.sendMessage(i),n=f(s);t(e=>{let t=e.map(e=>e.id===o?{...e,messages:[...e.messages,n],updatedAt:new Date}:e);return x(t),t})}catch(a){console.error("Failed to send message:",a),console.error("Error details:",{name:a instanceof Error?a.name:"Unknown",message:a instanceof Error?a.message:"Unknown error",stack:a instanceof Error?a.stack:void 0,apiEndpoint:_||"https://aps-junk-02-h7hxetfcdkfpeydk.canadacentral-01.azurewebsites.net"});let e="メッセージの送信に失敗しました。";a instanceof y?(console.log("API Error - Status: ".concat(a.status,", Message: ").concat(a.message)),e=500===a.status?"サーバーエラーが発生しました。(Status: ".concat(a.status,") しばらく待ってから再試行してください。"):404===a.status?"APIエンドポイントが見つかりません。(Status: ".concat(a.status,") サーバー設定を確認してください。"):0===a.status?"ネットワーク接続エラーです。CORS設定またはサーバーの起動状況を確認してください。":"API エラー (Status: ".concat(a.status,"): ").concat(a.message)):a instanceof Error&&(console.log("Generic Error: ".concat(a.message)),e=a.message.includes("Failed to fetch")||a.message.includes("Network error")?"ネットワークエラーが発生しました。API URL: ".concat(_||"https://aps-junk-02-h7hxetfcdkfpeydk.canadacentral-01.azurewebsites.net","への接続を確認してください。"):a.message.includes("CORS")?"CORS エラーが発生しました。サーバーのCORS設定を確認してください。":"エラーが発生しました: ".concat(a.message)),i(e);let s={id:(Date.now()+1).toString(),content:"❌ ".concat(e),role:"assistant",timestamp:new Date};t(e=>{let t=e.map(e=>e.id===o?{...e,messages:[...e.messages,s],updatedAt:new Date}:e);return x(t),t})}finally{n(!1)}},[s,m,x]);return{sessions:e,currentSessionId:s,messages:u,sendMessage:j,selectSession:p,startNewChat:g,isLoading:r,error:o,sessionState:c}};function F(e){let{projectId:t,initialFlow:s="analysis"}=e,{sessions:r,currentSessionId:n,messages:o,sendMessage:i,selectSession:c,startNewChat:d,isLoading:h}=R(),[u,x]=(0,l.useState)(s),[m,p]=(0,l.useState)(!1),g=(0,l.useRef)(null),y=()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})};(0,l.useEffect)(()=>{y()},[o]),(0,l.useEffect)(()=>{t&&localStorage.setItem("current:".concat(t),JSON.stringify({flow:u}))},[t,u]);let f=!n||0===o.length;return(0,a.jsxs)("div",{className:"flex h-screen overflow-hidden bg-gray-100",children:[(0,a.jsx)(N,{sessions:r,currentSessionId:n,onSelectSession:e=>c(e),onNewChat:()=>d(),selectedFlow:u,onSelectFlow:e=>x(e),onToggleOrganizer:()=>p(e=>!e)}),(0,a.jsx)("div",{className:"flex-1 flex flex-col min-w-0",children:f?(0,a.jsx)(I,{onSendMessage:(e,s)=>i(e,s,u,t),isLoading:h}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex-1 overflow-y-auto px-4 bg-gradient-to-br from-gray-50 via-white to-blue-50",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto py-6 space-y-1",children:[o.map(e=>(0,a.jsx)(C,{message:e},e.id)),h&&(0,a.jsxs)("div",{className:"flex gap-4 p-4 animate-pulse",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-4 h-4 bg-white rounded-full animate-ping"})}),(0,a.jsx)("div",{className:"flex-1 max-w-3xl",children:(0,a.jsx)("div",{className:"inline-block p-4 rounded-2xl bg-white border border-gray-200 rounded-bl-md",children:(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})})]}),(0,a.jsx)("div",{ref:g})]})}),(0,a.jsx)(P,{isLoading:h,onSendMessage:async(e,s)=>{if(t)try{localStorage.setItem("messages:".concat(t,":").concat(u),"1")}catch(e){}await i(e,s,u,t)}})]})}),m&&(0,a.jsx)(T,{projectId:t,flow:u,onSaved:()=>{if(t)try{localStorage.setItem("organizer:".concat(t,":").concat(u),"1")}catch(e){}}})]})}function H(){let e=(0,r.useSearchParams)(),t=e.get("projectId")||void 0,s=e.get("flow")||"analysis";return(0,a.jsx)(F,{projectId:t,initialFlow:s})}function L(){return(0,a.jsx)(l.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(H,{})})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=3130)}),_N_E=e.O()}]);